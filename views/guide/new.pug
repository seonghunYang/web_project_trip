extends ../layout

block content
  .container
    h1.main-title 트립고의 가이드가 되어주세요!
    form(action='/guide', method='POST', enctype="multipart/form-data")
      .form-group
        label(for='introduce') 소개
        textarea.form-control(name="introduce", rows="5")
      .form-group
        label(for='phone') 전화번호
        input.form-control(type='text', id='phone', name='phone', placeholder='010-xxxx-xxxx')
      .form-group
        label(for='residence') 거주지
        input.form-control(type='text', id='residence', name='residence', placeholder='거주지역 ex)프랑스>파인')
      .form-group
        label(for='img') 가이드 사진
        input#file.form-control(type="file")
        input#url.form-control(type="text", readonly="readonly", name="img", value="")
        img#preview.img-fluid(src="https://dummyimage.com/200x200/ccc/fff")
      
      button.btn.btn-primary(type='submit') 가이드 등록하기
  
  script.
    $(function() {
      $("#preview").hide();
      $("#file").change(function() {
        var file = $("#file")[0].files[0];
        if (file) {
          var url = "/s3?filename=" + encodeURIComponent(file.name) + 
                    "&type=" + encodeURIComponent(file.type);
          console.log(url);
          $.getJSON(url, function(resp) {
            console.log(resp.signedRequest);
            $.ajax({
              url: resp.signedRequest,
              method: 'PUT',
              data: file,
              headers: {'x-amz-acl': 'public-read', 'Content-Type': file.type},
              processData: false, 
              contentType: file.type,
              success: function() {
                $("#preview").attr("src", resp.url).show();
                $("#url").val(resp.url);
              }
            });
          });
        }
      });
    });